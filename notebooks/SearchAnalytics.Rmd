---
title: "Search Analytics"
output: html_notebook
---

```{r packages}
library(ggplot2)
```


```{r load data}
cjail = read.csv('../big-data/coronavirus_jail_full.csv', stringsAsFactors=FALSE)
```

```{r preprocessing}
cjail$publish_date = mapply(as.Date, x=cjail$publish_date)
```


MediaCloud search focused on titles mentioning incarceration-related terms and covid-related terms: title:((coronavirus OR COVID\* OR SARS) AND (jail OR prison\* OR incarc\* OR detain\* OR offend\* OR inmate\* OR "correctional facility" OR "detention center") NOT Weinstein\* NOT Exotic\* NOT Tekashi\* NOT 6ix9ine\* NOT Tiger\* NOT Avenatti\* NOT "R. Kelly\*" NOT Melly\* NOT Shkreli\* NOT Manafort\* NOT "Bernie Madoff\*" NOT "Michael Cohen\*") AND tags_id_stories:8878461

```{r search}
# Search text
pattern = "reform"
cjail$search_txt = mapply(grepl, pattern=pattern, x=cjail$new_text)
cjail$search_title = mapply(grepl, pattern=pattern, x=cjail$raw_title)

cjail$search = (cjail$search_txt | cjail$search_title)
```


```{r}
# Cumulative sums
search_over_time = cjail[order(cjail$publish_date), c("publish_date", "search")]
search_over_time$search_cumsum = cumsum(search_over_time$search)

search_over_time$placeholder = 1
search_over_time$cumsum_cnt = cumsum(search_over_time$placeholder)
search_over_time$placeholder = NULL

# Normalize counts over time
search_over_time$search_cumsum_norm = search_over_time$search_cumsum / max(search_over_time$search_cumsum)
search_over_time$cumsum_cnt_norm = search_over_time$cumsum_cnt / max(search_over_time$cumsum_cnt)
```

```{r}
ggplot() + 
  geom_line(data = search_over_time,
            aes(x = publish_date, y = search_cumsum_norm),
            color = "blue") + 
  geom_line(data = search_over_time,
            aes(x = publish_date, y = cumsum_cnt_norm), 
            color = "red") 
```

